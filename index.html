<script>
document.addEventListener("DOMContentLoaded", () => {

/* =========================
   SPA SECTION CONTROL
========================= */
function showSection(id){
  document.querySelectorAll('.hero, .game-section')
    .forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}
window.showSection = showSection;
showSection('hero');

/* =========================
   CASE DATA
========================= */
const cases = [
  {
    name: "Red Case",
    price: 0.50,
    skins: [
      {
        name: "AK-47 | Redline",
        rarity: "common",
        img: "https://steamcdn-a.akamaihd.net/apps/730/icons/econ/default_generated/weapon_ak47_cu_redline_light_large.6e0c0f5b1c.png",
        value: 25
      },
      {
        name: "AWP | Asiimov",
        rarity: "rare",
        img: "https://steamcdn-a.akamaihd.net/apps/730/icons/econ/default_generated/weapon_awp_cu_asiimov_light_large.5f2a6f52ef.png",
        value: 60
      },
      {
        name: "â˜… Karambit | Doppler",
        rarity: "legendary",
        img: "https://steamcdn-a.akamaihd.net/apps/730/icons/econ/default_generated/weapon_karambit_cu_doppler_light_large.0c1e21f6d3.png",
        value: 950
      }
    ]
  },
  {
    name: "Blue Case",
    price: 1.50,
    skins: [
      {
        name: "Desert Eagle | Blaze",
        rarity: "epic",
        img: "https://steamcdn-a.akamaihd.net/apps/730/icons/econ/default_generated/weapon_deagle_cu_blaze_light_large.1f2e6f2c.png",
        value: 150
      },
      {
        name: "M4A4 | Howl",
        rarity: "legendary",
        img: "https://steamcdn-a.akamaihd.net/apps/730/icons/econ/default_generated/weapon_m4a1_silencer_cu_howl_light_large.5d8d4b21.png",
        value: 800
      }
    ]
  }
];

/* =========================
   RENDER CASE CARDS
========================= */
const caseCardsDiv = document.getElementById("caseCards");
caseCardsDiv.innerHTML = "";

cases.forEach((c, i) => {
  const div = document.createElement("div");
  div.className = "caseCard";
  div.innerHTML = `
    <img src="${c.skins[0].img}" alt="${c.name}">
    <h4>${c.name}</h4>
    <p>â‚¬${c.price}</p>
  `;
  div.onclick = () => selectCase(i);
  caseCardsDiv.appendChild(div);
});

/* =========================
   CASE SELECTION
========================= */
let selectedCase = null;

function selectCase(index){
  selectedCase = cases[index];

  document.getElementById("caseOpenBox").style.display = "flex";
  document.getElementById("openCaseBtn").style.display = "inline-block";
  document.getElementById("caseStrip").style.transform = "translateX(0)";
  document.getElementById("caseStrip").innerHTML = "";
  document.getElementById("resultText").innerText = "";
  document.getElementById("resultImg").style.display = "none";
}

/* =========================
   CASE OPENING LOGIC
========================= */
window.startCaseOpen = function(){
  if (!selectedCase) return;

  const strip = document.getElementById("caseStrip");
  const resultText = document.getElementById("resultText");
  const resultImg = document.getElementById("resultImg");

  strip.innerHTML = "";
  strip.style.transition = "none";
  strip.style.transform = "translateX(0)";

  const totalItems = 30;
  const centerIndex = Math.floor(totalItems / 2);

  // pasirinkti laimimÄ… skin iÅ¡ tikrÅ³ case skin
  const winSkin =
    selectedCase.skins[Math.floor(Math.random() * selectedCase.skins.length)];

  // generuojam strip
  let generatedSkins = [];

  for (let i = 0; i < totalItems; i++) {
    let skin;

    if (i === centerIndex) {
      skin = winSkin;
    } else {
      skin = selectedCase.skins[
        Math.floor(Math.random() * selectedCase.skins.length)
      ];
    }

    generatedSkins.push(skin);

    const div = document.createElement("div");
    div.className = `caseItem ${skin.rarity}`;
    div.innerHTML = `
      <img src="${skin.img}" style="width:60px;height:60px;"><br>
      ${skin.name}
    `;
    strip.appendChild(div);
  }

  // pradedam animacijÄ…
  requestAnimationFrame(() => {
    strip.style.transition = "transform 3.2s cubic-bezier(0.15, 0.8, 0.2, 1)";
    const offset = -(centerIndex * 100 - 180);
    strip.style.transform = `translateX(${offset}px)`;
  });

  // rezultatas
  setTimeout(() => {
    resultText.innerHTML = `
      ðŸŽ‰ You won: <span style="color:#22c55e">${winSkin.name}</span>
      (â‚¬${winSkin.value})
    `;
    resultImg.src = winSkin.img;
    resultImg.style.display = "inline-block";
  }, 3300);
};

});
</script>

